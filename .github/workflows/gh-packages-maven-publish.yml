name: GitHub Packages Maven Publish

on:
    push:
        branches:
         - main
    release:
        types:
         - created

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
        - name: ğŸ“¥ Checkout repository 
          uses: actions/checkout@v2

        - name: â˜• Set up JDK
          uses: actions/setup-java@v2
          with:
            distribution: 'temurin'
            java-version: '25'

        - name: ğŸ“¡ Grab Hytale server jar (TEMP)
          run: |
                # Garbage code, remove once Hytale is available via Maven
                export HYTALE_DIR="$HOME/AppData/Roaming/Hytale/install/release/package/game/latest/Server"
                mkdir -p $HYTALE_DIR
                wget -O $HYTALE_DIR/HytaleServer.jar ${{ secrets.HYTALE_DOWNLOAD_LOCATION }} > /dev/null 2>&1
    
        - name: âš™ï¸ Build
          run: mvn clean package javadoc:javadoc
        
        - name: ğŸ†™ Upload the jar to GitHub
          uses: actions/upload-artifact@v4
          with:
            name: hymodslib.jar
            path: target/final/hymodslib.jar

        - name: ğŸš€ Deploy to GitHub Packages
          run: mvn --batch-mode deploy -DaltDeploymentRepository="github::default::https://maven.pkg.github.com/${{ github.repository_owner }}/${{ github.event.repository.name }}"
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        
        - name: ğŸ“– Upload Javadocs
          id: deployment
          uses: actions/upload-pages-artifact@v3
          with:
            path: target/site/apidocs
          
    deploy:
      environment:
        name: github-pages
        url: ${{ steps.deployment.outputs.page_url }}
      runs-on: ubuntu-latest
      needs: build
      steps:
        - name: ğŸ“– Deploy Javadocs
          id: deployment
          uses: actions/deploy-pages@v4